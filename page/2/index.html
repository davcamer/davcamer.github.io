<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>in two places at once</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="in two places at once">
<meta property="og:url" content="http://intwoplacesatonce.com/page/2/index.html">
<meta property="og:site_name" content="in two places at once">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="David Cameron">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="in two places at once" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">in two places at once</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://intwoplacesatonce.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-sleeping-in-batch-files" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/11/sleeping-in-batch-files/" class="article-date">
  <time datetime="2009-11-23T03:48:52.000Z" itemprop="datePublished">2009-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/11/sleeping-in-batch-files/">sleeping in batch files</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was recently debugging a situation involving CruiseControl.net where one <a target="_blank" rel="noopener" href="http://confluence.public.thoughtworks.org/display/CCNET/Executable+Task">&lt;exec&gt; task</a> would not complete until a second &lt;exec&gt; task in an unrelated project completed.</p>
<p>When it was originally <a target="_blank" rel="noopener" href="http://groups.google.com/group/ccnet-devel/browse_thread/thread/fdbc5228726a122d">described on the mailing list</a>, I thought it might be some interaction between batch files and the parallel task in the <a target="_blank" rel="noopener" href="http://ccnet.svn.sourceforge.net/viewvc/ccnet/trunk/project/core/util/ProcessExecutor.cs?revision=6352&view=markup">ProcessExecutor class</a>. ProcessExecutor encapsulates the concurrency aspect of running an external process and if there is a concurrency problem with processes, it’s probably in that class.</p>
<p>In any case, at that point I was seriously misunderstanding the problem, but it led me to some interesting debugging. For the debugging, I wanted to create a few long running batch files to run in parallel. But what is the batch equivalent of Thread.Sleep?</p>
<p>The <code>pause</code> command came to mind. It has no capabilities beyond displaying a “press any key” prompt and waiting for input. No parameters or switches at all. There is no <a target="_blank" rel="noopener" href="http://bashcurescancer.com/man/cmd/sleep"><code>sleep</code></a> command, as there is in bash. <code>wait</code> came to mind, but it is not a command either. I went to google…</p>
<p>And met <a target="_blank" rel="noopener" href="http://www.velocityreviews.com/forums/t172496-bat-file-pauses.html">with success</a>. The <code>choice</code> command can be used as a timed delay. The forum I found it in made it sound as if  <code>choice</code> is not available on every platform, but my Windows Server 2003 development image has it. The exact syntax of the command does seem to vary between versions, as some example on the web do not work on my system. For me, a command to wait five seconds is</p>
<pre lang="cmd">choice /M:"Waiting for 5 seconds" /T:5 /D:Y /C:Y</pre>

<p>A simple one-line batch file that waits for a given number of seconds is</p>
<pre lang="cmd">@choice /M:"Waiting for %1 seconds" /T:%1 /D:Y /C:Y</pre>

<p>As with many command-prompt commands, you can see more information about the command including the exact syntax for your version with</p>
<pre lang="cmd">choice /?</pre>

<p>If you are writing a cmd or bat script and need to wait or sleep for a short time, <code>choice</code> is well, choice.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://intwoplacesatonce.com/2009/11/sleeping-in-batch-files/" data-id="ckja6a8gs000hl99s1re5eatw" class="article-share-link">Share</a>
      
        <a href="http://intwoplacesatonce.com/2009/11/sleeping-in-batch-files/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cruisecontrol-net/" rel="tag">CruiseControl.net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/automation/" rel="tag">automation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/batch-files/" rel="tag">batch files</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cmd-scripts/" rel="tag">cmd scripts</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debugging/" rel="tag">debugging</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-measuring-msbuild-performance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/08/measuring-msbuild-performance/" class="article-date">
  <time datetime="2009-08-30T13:29:36.000Z" itemprop="datePublished">2009-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/08/measuring-msbuild-performance/">measuring msbuild performance</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently, while debugging some strange problems with our build, I flipped on MSBuild’s <code>diagnostic</code> output level. I was surprised and delighted to see a profile of my build at the end of the output. Here’s what the output looks like for <a target="_blank" rel="noopener" href="http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET">CruiseControl.Net’s</a> clean target:</p>
<pre lang="text">Project Performance Summary:
       16 ms  C:\code\ccnet-trunk\project\CCTray\CCTray.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\CCTrayLib\CCTrayLib.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\service\service.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\console\console.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\objection\objection.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\WebDashboard\WebDashboard.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\UnitTests\UnitTests.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\core\core.csproj   1 calls
                 16 ms  Clean                                      1 calls
       16 ms  C:\code\ccnet-trunk\project\Remote\Remote.csproj   1 calls
                 16 ms  Clean                                      1 calls
       31 ms  C:\code\ccnet-trunk\project\Validator\Validator.csproj   1 calls
                 31 ms  Clean                                      1 calls
      297 ms  C:\code\ccnet-trunk\project\ccnet.sln      1 calls
                297 ms  clean                                      1 calls

Target Performance Summary:
        0 ms  CleanReferencedProjects                   10 calls
        0 ms  SplitProjectReferencesByType               8 calls
        0 ms  BeforeClean                               10 calls
        0 ms  ValidateToolsVersions                      1 calls
        0 ms  AfterClean                                10 calls
        0 ms  CleanPublishFolder                        10 calls
       16 ms  _CheckForInvalidConfigurationAndPlatform  10 calls
       16 ms  _SplitProjectReferencesByFileExistence    10 calls
       16 ms  ValidateSolutionConfiguration              1 calls
      141 ms  CoreClean                                 10 calls
      281 ms  Clean                                     11 calls

Task Performance Summary:
        0 ms  FindUnderPath                             20 calls
        0 ms  AssignProjectConfiguration                 8 calls
        0 ms  Message                                   21 calls
        0 ms  MakeDir                                   10 calls
        0 ms  RemoveDuplicates                          10 calls
       16 ms  WriteLinesToFile                          10 calls
       31 ms  ReadLinesFromFile                         10 calls
       78 ms  Delete                                    11 calls
      281 ms  MSBuild                                    4 calls</pre>

<p>It’s quite easy to change the verbosity level from <a target="_blank" rel="noopener" href="http://nantcontrib.sourceforge.net/release/0.85-rc4/help/tasks/msbuild.html">NAnt’s MSBuild task</a>:</p>
<pre lang="xml"><msbuild verbosity="Diagnostic" project="project\ccnet.sln">
    <property name="Configuration" value="Build" />
</msbuild>
</pre>

<p>I was happy to see profiling information because the speed of the build in Visual Studio on our current project is making unit tests painful. Running a single unit test involves waiting for about a minute while the code compiles and ReSharper’s test runner starts up. Then the test runs, generally taking less than a second. The profiling output from MSBuild seems like an ideal way to diagnose the compile speed problem. I played around with different output settings to understand what’s available before tackling the build speed problem. After all, measuring something usually changes it.</p>
<p>One of the first things I noticed was that using the Diagnostic verbosity level very significantly slowed my build down. I decided to quantify that slow down, and check to make sure that the other verbosity levels don’t suffer from a similar problem. Here are the summarized results.</p>
<table class="data-table">
<thead>
<tr><td/><td colspan="2">total time</td><td colspan="2">std deviation</td></tr>
<tr><td class="corner">verbosity</td><td>compile</td><td>clean</td><td>compile</td><td>clean</td></tr>
</thead>
<tbody>
<tr><td>Diagnostic</td><td>88.6s</td><td>19.4s</td><td>±6.3s</td><td>±0.6s</td></tr>
<tr><td>Detailed</td><td>32.1s</td><td>5.7s</td><td>±3.8s</td><td>±0.2s</td></tr>
<tr><td>Normal</td><td>14.9s</td><td>1.1s</td><td>±1.4s</td><td>±0.03s</td></tr>
<tr><td>Minimal</td><td>13.5s</td><td>0.3s</td><td>±0.8s</td><td>±0.05s</td></tr>
<tr><td>Quiet</td><td>14.0s</td><td>0.3s</td><td>±1.4s</td><td>±0.02s</td></tr>
</tbody>
</table>

<p>I did 5 builds at each level, and averaged the results. Since I needed to clean anyway between each test, I gathered those stats too. MSBuild provides the information in milliseconds, but I am presenting it in seconds. It seems like Normal is a reasonable setting where the output doesn’t slow the build down significantly. Minimal is slightly faster, and I prefer it anyway because I find the terser output easier to follow.</p>
<p>To gather timings for different verbosities, I didn’t use NAnt, but instead invoked <code>msbuild</code> directly from the command-line. Of the available verbosity levels, only Diagnostic gives the performance summary. Luckily, there is another switch that allows more fine-grained tuning of what appears on the console. Here are a couple of examples, but <code>msbuild /?</code> can give you more information.</p>
<pre lang="text">C:\code\ccnet-trunk\project>msbuild ccnet.sln /verbosity:Diagnostic

C:\code\ccnet-trunk\project>msbuild ccnet.sln /target:clean /consoleloggerparameters:verbosity=normal;PerformanceSummary</pre>

<p>Before jumping to conclusions about MSBuild’s performance, I wanted to check if the slowdown is tied to using Diagnostic level at all, or just using it on the console. After all, the windows command prompt is known to be a bit of a slouch. I tried a build with Diagnostic level logging being sent to a file:</p>
<pre lang="text">C:\code\ccnet-trunk\project>msbuild ccnet.sln /noconsolelogger /filelogger /fileloggerparameters:verbosity=Diagnostic;PerformanceSummary</pre>

<p>With these settings, the build takes only 15.2 seconds, but still generates the full 1.5 megabytes of diagnostic logs. It seems the performance problem really lies with Windows Command Prompt. I want to try to determine if logging suffers the same penalties during a build on a continuous integration server or through Visual Studio. I have not yet discovered how to tweak the verbosity level from Visual Studio. For the CI server, I simply have not yet bothered to do the test. If there is a slowdown during CI, a simple fix may be to log all the output to a file and then include that in the build artifacts.</p>
<p>For now though, I’m planning on tweaking my solution structure as <a target="_blank" rel="noopener" href="http://codebetter.com/blogs/patricksmacchia/archive/2009/03/15/analyzing-the-code-base-of-cruisecontrol-net.aspx">Patrick Smacchia suggests</a> to see if there is a noticeable build speed improvement.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://intwoplacesatonce.com/2009/08/measuring-msbuild-performance/" data-id="ckja6a8gm0008l99shde90hc1" class="article-share-link">Share</a>
      
        <a href="http://intwoplacesatonce.com/2009/08/measuring-msbuild-performance/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/msbuild/" rel="tag">msbuild</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/performance/" rel="tag">performance</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-installing-hg-subversion-on-windows-to-test-it" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/07/installing-hg-subversion-on-windows-to-test-it/" class="article-date">
  <time datetime="2009-07-20T04:19:28.000Z" itemprop="datePublished">2009-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/installing-hg-subversion-on-windows-to-test-it/">installing hg subversion on windows to test it</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>If you follow along, by the end of this blog post you’ll be able to run the hgsubversion tests on your Windows system. Unfortunately, it probably won’t work 100% correctly for you. Like the <a target="_blank" rel="noopener" href="http://bitbucket.org/durin42/hgsubversion/wiki/Home">hgsubversion wiki</a> says, “You should only be using this if you’re ready to hack on it, and go diving into the internals of Mercurial and/or Subversion.”</em></p>
<p>I really like <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/Mercurial">Mercurial</a>. I think Subversion is starting to get a little creaky. Even worse, for whatever reason access to the <a target="_blank" rel="noopener" href="http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET">CruiseControl.net</a> <a target="_blank" rel="noopener" href="https://ccnet.svn.sourceforge.net/svnroot/ccnet/">subversion repository</a> is so slow for me from Australia that most operations I try eventually time out. It’s quite frustrating. Mercurial keeps most of the familiar Subversion operations but adds DVCS goodness like having all history in a local repository. That would nicely solve my speed problems.</p>
<p>I’ve been maintaining a <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/ccnet/overview/">Mercurial repository of cc.net on bitbucket</a> for a few months now. I use the excellent <a target="_blank" rel="noopener" href="http://bitbucket.org/durin42/hgsubversion/wiki/Home">hg subversion extension</a>, installed on my Mac OS X partition. I don’t have an instance of Mercurial on my Windows partition with the hg subversion extension installed. To install on OS X I followed <a target="_blank" rel="noopener" href="http://farmdev.com/thoughts/64/try-out-the-mercurial-subversion-extension-hg-svn-on-mac-os-x/">this recipe</a>. I have not found a similarly detailed recipe for Windows. Here’s my attempt at writing such a recipe.</p>
<p>The outline is:</p>
<ol>
<li> install <a target="_blank" rel="noopener" href="http://www.python.org/download/releases/2.6.2/">python 2.6</a></li>
<li> <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/WindowsInstall">build and install</a> Mercurial</li>
<li> download <a target="_blank" rel="noopener" href="http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100">subversion binaries</a></li>
<li> install <a target="_blank" rel="noopener" href="http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100">svn-python bindings</a></li>
<li> install <a target="_blank" rel="noopener" href="http://gnuwin32.sourceforge.net/packages/diffutils.htm">gnu diffutils</a></li>
<li> clone <a target="_blank" rel="noopener" href="http://bitbucket.org/durin42/hgsubversion/wiki/Home">hg subversion</a></li>
<li> configure the <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/Win32TextExtension">win32text extension</a></li>
<li> install <a target="_blank" rel="noopener" href="http://code.google.com/p/python-nose/">nose</a></li>
<li> run the tests</li>
</ol>
<p>I’ll go in to more detail – the above is at least an advanced level exercise. The entire install is a command-line exercise. Because of that, paths are very important. I use a folder <code>c:\code</code> to work with sources. I’ll leave that path in my examples, but remember if you would like to change it to something else that is okay. Do remember to change it everywhere though.</p>
<h4 id="0-Setting-up-paths"><a href="#0-Setting-up-paths" class="headerlink" title="0. Setting up paths"></a>0. Setting up paths</h4><p>During installation I isolated myself somewhat by using a batch file to reset my path. That gave me more confidence that my existing TortoiseSVN and TortoiseHg installs wouldn’t interfere with the hgsubversion install. Visual Studio installs a <em>Visual Studio 2008 Commmand Prompt</em> shortcut on to the start menu that opens a command window with specific environment variables set. I copied it to create a similar shortcut for my install work. The shortcut uses these settings:</p>
<p><img src="http://intwoplacesatonce.com/wp-content/uploads/2009/07/screen-capture1.png" alt="screen-capture.png"></p>
<p>Then it’s a matter of editing <code>set_hg_paths.bat</code> to set the correct <code>%PATH%</code> value. It doesn’t matter if <code>%PATH%</code> includes folders that are not yet on disk, so you can set all your paths now and the appropriate pieces will be picked up when they are available. My <code>set_hg_paths.bat</code> file contains:</p>
<pre lang="text">set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.6.3\bin;C:\Program Files\GnuWin32\bin\;c:\windows\system32;c:\windows;c:\windows\system32\wbem;</pre>

<h4 id="1-Install-python-2-6"><a href="#1-Install-python-2-6" class="headerlink" title="1. Install python 2.6"></a>1. Install python 2.6</h4><p>Mercurial is written in python, runs on it, and hg subversion is a collection of python scripts so this is absolutely necessary. I downloaded <a target="_blank" rel="noopener" href="http://www.python.org/download/releases/2.6.2/">2.6.2</a> from the <a target="_blank" rel="noopener" href="http://www.python.org/">python home page</a>, and installed it to the default location of <code>c:\python26</code>.</p>
<p>To test this step, open a command prompt using the shortcut from step 0. If you run the commands as shown, you should get the same output: <pre lang="text">c:\code>python --version<br>Python 2.6.2</pre></p>
<h4 id="2-Build-and-install-Mercurial"><a href="#2-Build-and-install-Mercurial" class="headerlink" title="2. Build and install Mercurial"></a>2. Build and install Mercurial</h4><p>I have already tried out Mercurial on Windows, using two different pre-packaged Mercurial distributions: one for <a target="_blank" rel="noopener" href="http://mercurial.berkwood.com/">command-line</a> and one following the <a target="_blank" rel="noopener" href="http://bitbucket.org/tortoisehg/stable/wiki/Home">TortoiseSCM</a> <a target="_blank" rel="noopener" href="http://www.tortoisecvs.org/">tradition</a>.</p>
<p>Unfortunately, the pre-built binaries do not seem to be appropriate for extensions. They package the python run-time internally. This is nice on the one hand because people can get Mercurial with a single download. It does make it difficult to experiment however because it is not clear how to add python and hg extensions to the packaged run-time. Maybe if hgsubversion runs well enough on Windows, it will be included in the packages.</p>
<p>To try out hgsubversion, for now, I needed to download the Mercurial source. There are rough instructions for an <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/WindowsInstall">install from source</a> on the Mercurial wiki. Since I don’t yet have a working hg in my installation environment, I downloaded the <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/release/mercurial-1.3.tar.gz">1.3 source archive</a> from the <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/release/?M=D">Mercurial site</a>. After downloading I unzipped to <code>c:\code\Mercurial_src</code>. The <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/WindowsInstall#Overview">wiki</a>‘s Standard procedure section describes a two-step build process using build and install targets. I followed those steps.</p>
<p>The build step compiles some C code. The <code>%PATH%</code> variable needs a C compiler for build to work. I have Visual Studio 2008 installed and it comes with a batch file to add the tools to the <code>%PATH%</code>. I added it on to the end of my <code>set_hg_paths.bat</code>. The compiler is only needed for this step, so you may prefer to just execute the batch file once.</p>
<pre lang="text">set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.6.3\bin;C:\Program Files\GnuWin32\bin\;c:\windows\system32;c:\windows;c:\windows\system32\wbem;

"c:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat"</pre>

<p>With that set, I opened another command window with the new <code>set_hg_paths.bat</code> and ran the build and install steps. I’ve pasted the beginning and end of the input below. I also saved the <a href="http://intwoplacesatonce.com/wp-content/uploads/2009/07/mercurial_build.txt" title="mercurial_build.txt">full build and install log</a>.</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.6.3\bin;C:\Program Files\GnuWin32\bin\;c
:\windows\system32;c:\windows;c:\windows\system32\wbem;

c:\code>"c:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat"
Setting environment for using Microsoft Visual Studio 2008 x86 tools.

c:\code>echo %PATH%
c:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE;c:\Program Files\Microsoft Visual Studio 9.0\VC\BIN;c:\Program
Files\Microsoft Visual Studio 9.0\Common7\Tools;c:\WINDOWS\Microsoft.NET\Framework\v3.5;c:\WINDOWS\Microsoft.NET\Framewo
rk\v2.0.50727;c:\Program Files\Microsoft Visual Studio 9.0\VC\VCPackages;C:\Program Files\\Microsoft SDKs\Windows\v6.0A\
bin;c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.6.3\bin;C:\Program Files\GnuWin32\bin\;c:\windows\sys
tem32;c:\windows;c:\windows\system32\wbem;

c:\code>cd Mercurial_src

C:\code\Mercurial_src>python setup.py build --force
running build
running build_py
copying mercurial\ancestor.py -> build\lib.win32-2.6\mercurial
.... full log in the attached file ....
copying contrib\win32\hg.bat -> build\scripts-2.6
running build_mo
warning: build_mo: could not find msgfmt executable, no translations will be built

C:\code\Mercurial_src>python setup.py install --force --skip-build
running install
running install_lib
copying build\lib.win32-2.6\hgext\acl.py -> c:\python26\Lib\site-packages\hgext
.... full log in the attached file ....
copying i18n\zh_TW.po -> c:\python26\Lib\site-packages\mercurial\i18n
running install_egg_info
Removing c:\python26\Lib\site-packages\mercurial-1.3-py2.6.egg-info
Writing c:\python26\Lib\site-packages\mercurial-1.3-py2.6.egg-info

C:\code\Mercurial_src></pre>

<p>To test this step, I checked the version of hg that my command-prompt was now picking up. I added a new folder to my <code>%PATH%</code> at this point, although if you followed step 0, you will already have it included.</p>
<pre lang="text">c:\code>echo %PATH%
c:\python26\;c:\python26\scripts\;

c:\code>hg version
Mercurial Distributed SCM (version 1.3)

Copyright (C) 2005-2009 Matt Mackall <mpm@selenic.com> and others
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>

<h4 id="3-Download-Subversion-binaries"><a href="#3-Download-Subversion-binaries" class="headerlink" title="3. Download Subversion binaries"></a>3. Download Subversion binaries</h4><p>As I said before, Mercurial is written in python. To interact with Subversion it makes calls in to Subversion binaries written in C. The easiest, cleanest way to get an up to date version of the Subversion binaries is to download and install a binary distribution of Subversion. This needs to be compatible with the binaries in the next step, so I <a target="_blank" rel="noopener" href="http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100&expandFolder=8100&folderID=8100">got both</a> from Subversion’s <a target="_blank" rel="noopener" href="http://subversion.tigris.org/getting.html#windows">download page</a> at tigris.org. I downloaded the <a target="_blank" rel="noopener" href="http://subversion.tigris.org/svn_1.6_releasenotes.html">1.6.3</a> binaries compiled against Apache 2.2. After downloading the zip package, I unzipped it to <code>c:\Program Files\svn-win32-1.6.3</code>.</p>
<p>The other binary distributions of Subversion are great, but similarly to Mercurial the basic package is preferred here because it is more compatible with extensions. <a target="_blank" rel="noopener" href="http://www.sliksvn.com/en/download">Slik</a> has a very easy to install, minimal package that is great for clients where command-line or scripting is used. At my current job we use <a target="_blank" rel="noopener" href="http://www.visualsvn.com/server/">VisualSVN Server</a> as our Subversion repository because it is easy to install and administer on Windows. Unfortunately, I don’t believe they are useful to us for installing hgsubversion.</p>
<p>After adding <code>C:\Program Files\svn-win32-1.6.3\bin</code> to my <code>set_hg_path.bat</code>, I tested this step by opening a new prompt and checking the version of <code>svn</code> that was being picked up:</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.
6.3\bin;

c:\code>svn --version
svn, version 1.6.3 (r38063)
   compiled Jun 22 2009, 09:59:12

Copyright (C) 2000-2009 CollabNet.
Subversion is open source software, see http://subversion.tigris.org/
This product includes software developed by CollabNet (http://www.Collab.Net/).

The following repository access (RA) modules are available:

* ra_neon : Module for accessing a repository via WebDAV protocol using Neon.
  - handles 'http' scheme
  - handles 'https' scheme
* ra_svn : Module for accessing a repository using the svn network protocol.
  - with Cyrus SASL authentication
  - handles 'svn' scheme
* ra_local : Module for accessing a repository on local disk.
  - handles 'file' scheme
* ra_serf : Module for accessing a repository via WebDAV protocol using serf.
  - handles 'http' scheme
  - handles 'https' scheme</pre>

<h4 id="4-Install-svn-python-bindings"><a href="#4-Install-svn-python-bindings" class="headerlink" title="4. Install svn-python bindings"></a>4. Install svn-python bindings</h4><p>This piece is the “glue-code” that allows Mercurial, written in Python, to call the binary Subversion API, written in C. To side-step as many problems as possible these should be from the same compile that created the Subversion binaries. For that reason, I downloaded <a target="_blank" rel="noopener" href="http://subversion.tigris.org/files/documents/15/46152/svn-python-1.6.3.win32-py2.6.exe">my bindings</a> from <a target="_blank" rel="noopener" href="http://subversion.tigris.org/servlets/ProjectDocumentList?expandFolder=91&folderID=8100">the same page</a> I used above. These are the python 2.6, svn 1.6.3, apache 2.2, win32 bindings packaged as an executable installer.</p>
<p>After downloading, I ran the executable. The setup wizard automatically detected my Python 2.6 installation.<br><img src="http://intwoplacesatonce.com/wp-content/uploads/2009/07/screen-capture-11.png" alt="screen-capture-1.png"></p>
<h4 id="5-Install-gnu-diffutils"><a href="#5-Install-gnu-diffutils" class="headerlink" title="5. Install gnu diffutils"></a>5. Install gnu diffutils</h4><p>Mercurial relies on a command-line <code>diff</code> program. <code>diff</code> is ubiquitous on Unix-related systems, but not a common program on Windows. There is a port of the gnu version for windows available as a package called <a target="_blank" rel="noopener" href="http://gnuwin32.sourceforge.net/packages/diffutils.htm">DiffUtils for Windows</a>. I downloaded the <a target="_blank" rel="noopener" href="http://gnuwin32.sourceforge.net/downlinks/diffutils.php">Complete package, except sources</a> and ran the wizard to install it.</p>
<p><img src="http://intwoplacesatonce.com/wp-content/uploads/2009/07/screen-capture-2.png" alt="screen-capture-2.png"></p>
<p>To check it, I added <code>C:\Program Files\GnuWin32\bin</code> to my <code>%PATH%</code> and ran <code>diff</code> to make sure it could be found:</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.
6.3\bin;C:\Program Files\GnuWin32\bin\;

c:\code>diff --version
diff (GNU diffutils) 2.8.7
Written by Paul Eggert, Mike Haertel, David Hayes,
Richard Stallman, and Len Tower.

Copyright (C) 2004 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>

<h4 id="6-Clone-hgsubversion"><a href="#6-Clone-hgsubversion" class="headerlink" title="6. Clone hgsubversion"></a>6. Clone hgsubversion</h4><p>Having Mercurial working locally at this point, I used it to clone the <a target="_blank" rel="noopener" href="http://bitbucket.org/durin42/hgsubversion/wiki/Home">hgsubversion</a> code from <a target="_blank" rel="noopener" href="http://bitbucket.org/">bitbucket</a>. I used the -U option to skip the local working copy checkout, because I want to configure an extension in the repository before getting the local working copy.</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.
6.3\bin;C:\Program Files\GnuWin32\bin\;

C:\code>hg clone -U http://bitbucket.org/durin42/hgsubversion/
destination directory: hgsubversion
requesting all changes
adding changesets
adding manifests
adding file changes
added 475 changesets with 1178 changes to 161 files</pre>

<h4 id="7-Configure-the-win32text-extension"><a href="#7-Configure-the-win32text-extension" class="headerlink" title="7. Configure the win32text extension"></a>7. Configure the win32text extension</h4><p>Mercurial has a convention of storing line endings for text files as line-feeds only, the Unix convention. The Windows convention is to use both carriage-return and line-feed characters to mark line endings. To work with hgsubversion source on Windows without mixing line endings I configured the <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/Win32TextExtension">win32text extension</a> to <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/FAQ#FAQ.2BAC8-TechnicalDetails.What_about_Windows_line_endings_vs._Unix_line_endings.3F">handle conversion</a> as files move in and out of the working copy.</p>
<p>To turn it on, I opened up <code>c:\code\hgsubversion\.hg\hgrc</code> and modified the content as follows:</p>
<pre lang="ini">[paths]
default = http://bitbucket.org/durin42/hgsubversion/

[extensions]
hgext.win32text=

[encode]
# Encode files that don't contain NUL characters.
** = cleverencode:

[decode]
# Decode files that don't contain NUL characters.
** = cleverdecode:

[patch]
# Turn on special handling for line-endings at patch-time
eol = crlf

[hooks]
# Reject commits which would introduce windows-style text" files
pretxncommit.crlf = python:hgext.win32text.forbidcrlf</pre>

<p>After changing the config, I updated my working copy. Although there is a warning, I’m not sure how to best handle it.</p>
<pre lang="text">C:\code>cd hgsubversion

C:\code\hgsubversion>hg update
WARNING: tests/test_push_eol.py already has CRLF line endings
and does not need EOL conversion by the win32text plugin.
Before your next commit, please reconsider your encode/decode settings in
Mercurial.ini or C:\code\hgsubversion\.hg\hgrc.
125 files updated, 0 files merged, 0 files removed, 0 files unresolved</pre>

<p>Feeling a bit curious I opened up the files in <a target="_blank" rel="noopener" href="http://notepad-plus.sourceforge.net/uk/site.htm">Notepad++</a>, which can show line ending characters. All the files now had CR-LF endings, as expected.</p>
<h4 id="8-Install-nose"><a href="#8-Install-nose" class="headerlink" title="8. Install nose"></a>8. Install nose</h4><p><a target="_blank" rel="noopener" href="http://code.google.com/p/python-nose/">nose</a> is an alternative Python test runner that hgsubversion uses. There is an explanation in the hgsubversion <a target="_blank" rel="noopener" href="http://bitbucket.org/durin42/hgsubversion/src/tip/README"><code>README</code> file</a>. Since I thought there would probably be test failures, I decided to install nose.</p>
<p>The easiest way to install nose is with a script called <code>easy_install</code>. The Windows Python distribution does not come with the setuptools package that provides <code>easy_install</code> by default, so I installed it first. There is not yet a self-installing package of setuptools for Windows and Python 2.6. This <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/309412/how-to-setup-setuptools-for-python-2-6-on-windows">stack overflow question</a> referred me to <a target="_blank" rel="noopener" href="http://peak.telecommunity.com/dist/ez_setup.py">this script</a> that downloaded and installed setuptools for me. I had to use <em>Save As…</em> in the browser to avoid ending up with html tags and escapes in the script.</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.
6.3\bin;C:\Program Files\GnuWin32\bin\;

c:\code>cd ez_setup

C:\code\ez_setup>python ez_setup.py
Downloading http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c9-py
2.6.egg
Processing setuptools-0.6c9-py2.6.egg
Copying setuptools-0.6c9-py2.6.egg to c:\python26\lib\site-packages
Adding setuptools 0.6c9 to easy-install.pth file
Installing easy_install-script.py script to c:\python26\Scripts
Installing easy_install.exe script to c:\python26\Scripts
Installing easy_install-2.6-script.py script to c:\python26\Scripts
Installing easy_install-2.6.exe script to c:\python26\Scripts

Installed c:\python26\lib\site-packages\setuptools-0.6c9-py2.6.egg
Processing dependencies for setuptools==0.6c9
Finished processing dependencies for setuptools==0.6c9</pre>

<p>With easy_install working, it <strong>is</strong> easy to install nose:</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.
6.3\bin;C:\Program Files\GnuWin32\bin\;

c:\code>easy_install nose
Searching for nose
Reading http://pypi.python.org/simple/nose/
Reading http://somethingaboutorange.com/mrl/projects/nose/
Best match: nose 0.11.1
Downloading http://somethingaboutorange.com/mrl/projects/nose/nose-0.11.1.tar.gz

Processing nose-0.11.1.tar.gz
Running nose-0.11.1\setup.py -q bdist_egg --dist-dir c:\docume~1\admini~1\locals
~1\temp\easy_install-uirbjm\nose-0.11.1\egg-dist-tmp-kslr2c
no previously-included directories found matching 'doc\.build'
Adding nose 0.11.1 to easy-install.pth file
Installing nosetests-2.6-script.py script to c:\python26\Scripts
Installing nosetests-2.6.exe script to c:\python26\Scripts
Installing nosetests-script.py script to c:\python26\Scripts
Installing nosetests.exe script to c:\python26\Scripts

Installed c:\python26\lib\site-packages\nose-0.11.1-py2.6.egg
Processing dependencies for nose
Finished processing dependencies for nose</pre>

<h4 id="9-Run-the-tests"><a href="#9-Run-the-tests" class="headerlink" title="9. Run the tests"></a>9. Run the tests</h4><p>After all that, I ran the tests by executing <code>nosetests</code> in the hgsubversion folder. The results give many failures. I started working to correct them a couple of weeks ago and posted my work to <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/hgsubversion-py26-win/">bitbucket</a>. I’ll have to write more about that in a subsequent post. Some of the failures today look new to me.</p>
<p>The start and end of the log follows. Again, I’ve attached the <a href="http://intwoplacesatonce.com/wp-content/uploads/2009/07/hgsubversion_tests.txt" title="hgsubversion_tests.txt">full log</a>.</p>
<pre lang="text">c:\code>set PATH=c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.6.3\bin;C:\Program Files\GnuWin32\bin\;c
:\windows\system32;c:\windows;c:\windows\system32\wbem;

c:\code>"c:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat"
Setting environment for using Microsoft Visual Studio 2008 x86 tools.

c:\code>echo %PATH%
c:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE;c:\Program Files\Microsoft Visual Studio 9.0\VC\BIN;c:\Program
Files\Microsoft Visual Studio 9.0\Common7\Tools;c:\WINDOWS\Microsoft.NET\Framework\v3.5;c:\WINDOWS\Microsoft.NET\Framewo
rk\v2.0.50727;c:\Program Files\Microsoft Visual Studio 9.0\VC\VCPackages;C:\Program Files\\Microsoft SDKs\Windows\v6.0A\
bin;c:\python26\;c:\python26\scripts\;c:\Program Files\svn-win32-1.6.3\bin;C:\Program Files\GnuWin32\bin\;c:\windows\sys
tem32;c:\windows;c:\windows\system32\wbem;

C:\code>cd hgsubversion

C:\code\hgsubversion>python setup.py build
running build
running build_py
copying hgsubversion\util.py -> build\lib\hgsubversion

C:\code\hgsubversion>nosetests
..FEE..F..FFEEFFEEFFEEEEEEEEFFF..EEFFFFFEEFFFFEF.....FF..FFF.FFFFF..EE..FF.EEEEEEEEEEEEEEEEEEE..EEFF..FFFFFFFFFFFFFFFFFF
FFFF..FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEEEEEEFFFFF...EEEEEEFFF......EEEFFEEF
======================================================================
ERROR: test_externals (tests.test_externals.TestFetchExternals)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\hgsubversion\tests\test_externals.py", line 60, in test_externals
    self.assertEqual(ref0, repo[0]['.hgsvnexternals'].data())
  File "c:\python26\lib\site-packages\mercurial\context.py", line 84, in __getitem__
    return self.filectx(key)
  File "c:\python26\lib\site-packages\mercurial\context.py", line 159, in filectx
    fileid = self.filenode(path)
  File "c:\python26\lib\site-packages\mercurial\context.py", line 148, in filenode
    return self._fileinfo(path)[0]
  File "c:\python26\lib\site-packages\mercurial\context.py", line 143, in _fileinfo
    _('not found in manifest'))
LookupError: .hgsvnexternals@000000000000: not found in manifest
-------------------- >> begin captured stdout << ---------------------
no changes found

--------------------- >> end captured stdout << ----------------------
.... full text in attached log ....
======================================================================
FAIL: test_rebase (tests.test_utility_commands.UtilityTests)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\hgsubversion\tests\test_utility_commands.py", line 176, in test_rebase
    self.assertEqual(self.repo['tip'].parents()[0].parents()[0], self.repo[0])
AssertionError: <changectx 000000000000> != <changectx 8bc599092f77>
-------------------- >> begin captured stdout << ---------------------
no changes found
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
Nothing to rebase!

--------------------- >> end captured stdout << ----------------------

----------------------------------------------------------------------
Ran 225 tests in 161.242s

FAILED (errors=59, failures=132)</pre>
<p>That’s it for now. I believe at this point you could install the extension. Things might not work correctly though. I’m going to attempt to get more tests working locally for myself before I try turning it on and cloning anything. Even after that I’ll need to try it with a few different Subversion repositories before using it for code I care about. SCM is too central to my development practices for me to use a shaky system.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://intwoplacesatonce.com/2009/07/installing-hg-subversion-on-windows-to-test-it/" data-id="ckja6a8i7004sl99sauio72hy" class="article-share-link">Share</a>
      
        <a href="http://intwoplacesatonce.com/2009/07/installing-hg-subversion-on-windows-to-test-it/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mercurial/" rel="tag">Mercurial</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/subversion/" rel="tag">Subversion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hg/" rel="tag">hg</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hgsubversion/" rel="tag">hgsubversion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/howto/" rel="tag">howto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/open-source/" rel="tag">open source</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/svn/" rel="tag">svn</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-introducing-a-changeset-class-to-cruisecontrol-net-shifting-to-supertypes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-shifting-to-supertypes/" class="article-date">
  <time datetime="2009-07-09T02:41:33.000Z" itemprop="datePublished">2009-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-shifting-to-supertypes/">introducing a ChangeSet class to CruiseControl.net: shifting to supertypes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>When I refactor, I try to get the first piece of the change in with absolute minimal impact on the surrounding code. Once that first bit of the change is in, it often feels like the rest of the code will change itself to adapt. Those changes turn out better than what I could have designed up front. Of course, the code isn’t changing itself – the rest of the team is making the changes. Getting a bit of the change in to the actual system is the clearest way I know of communicating the intention to the rest of the team. Then if my idea makes any sense, the team will get ideas and make changes of their own.</p>
<p>I am taking the same approach with this refactoring. As a first stage, introduce ChangeSet with minimal impact on the rest of the code. Give time for the team to see some of the possibilities. Not removing any existing classes at this point.</p>
<p>What makes this different from refactorings I have done at my day job is the number of people involved. <a target="_blank" rel="noopener" href="http://www.stevetrefethen.com/blog/">Steve Trefethen</a> reminded me of this on the <a target="_blank" rel="noopener" href="http://groups.google.com.au/group/ccnet-devel/msg/da8e7de5cb0c2add?hl=en">mailing list</a> today. I had not even considered that someone may have subclassed <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/ccnet/src/0375206b36d0/project/core/sourcecontrol/Modification.cs">Modification</a> for their own purposes. But they have. Steve has been on the receiving end of <a target="_blank" rel="noopener" href="http://groups.google.com.au/group/ccnet-devel/browse_thread/thread/542ce5a39d5a9859/e0c1762e10d77313?hl=en&lnk=gst&q=strefethen+processexecutor#e0c1762e10d77313">painful breaking changes</a> in the past, so I want to listen carefully to his objections and hopefully minimise his pain. Users sticking with old versions complicates support. And, although Steve is only one user there are probably dozens or hundreds of users experiencing the same issues he is raising.</p>
<p>Now what can be done to avoid breaking other’s code. This whole refactoring centres around one method on the <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/ccnet/src/tip/project/core/sourcecontrol/ISourceControl.cs">ISourceControl</a> interface:</p>
<pre lang="csharp">public interface ISourceControl
{
    Modification[] GetModifications(IIntegrationResult from, IIntegrationResult to);</pre>
<p>All the Modification objects in the system are originally returned by a call to this method. The capability to return ChangeSets needs to be introduced at this point. But, changing all the existing implementers of ISourceControl to return ChangeSets at the same time would be too much work. It would also require a lot of users to change their code, because ISourceControl is one of the natural extension points of the system. Fortunately, .net is on my side with this one.</p>
<p>A quick digression to sing the praises of .net. Every single type in .net derives from <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.object.aspx">Object</a>, including all the apparently built-in types like <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.array.aspx">arrays</a>. The compiler does work some magic around descendants of <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.valuetype.aspx">ValueType</a> to pass them on the stack. That way small types like <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.int32.aspx">int</a>, <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.boolean.aspx">bool</a> and <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.single.aspx">float</a> work faster than they would otherwise. You can create your own ValueTypes, passed on the stack, using the <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/ah19swz4.aspx">struct</a> keyword. All of these still derive from Object.</p>
<p>But getting back to it, every last type is part of the same hierarchy including our Modification[] return type.</p>
<p><img src="http://intwoplacesatonce.com/wp-content/uploads/2009/07/screen-capture-1.png" alt="screen-capture-1.png"></p>
<p>Changing the return type to one of the supertypes of Modification[] would allow us to introduce a new class. Besides changing the method signature, existing code could remain the same and continue to return Modification[].</p>
<p>Using the type closest to the base of the hierarchy provides the most flexibility for implementing another class. I know from <a target="_blank" rel="noopener" href="http://www.markhneedham.com/blog/2009/06/12/coding-dojo-17-refactoring-cruise-control-net/">previous experimentation</a> that we can use IEnumerable&lt;Modification&gt; for everything except the tests. Linq can cover the test requirements. We have not previously included Linq in the CruiseControl.net codebase and I thought it was because of Mono concerns. I’ve found out today that Linq is included in Mono, so I can use it to update the tests. Time to go make <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/ccnet/changeset/c6ae81ea556f/">these changes</a>, on a branch.</p>
<pre lang="csharp">public interface ISourceControl
{
    IEnumerable<Modfication> GetModifications(IIntegrationResult from, IIntegrationResult to);</pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://intwoplacesatonce.com/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-shifting-to-supertypes/" data-id="ckja6a8gj0004l99s26tmawkv" class="article-share-link">Share</a>
      
        <a href="http://intwoplacesatonce.com/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-shifting-to-supertypes/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cruisecontrol-net/" rel="tag">CruiseControl.net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/introducing-changeset/" rel="tag">introducing ChangeSet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/refactoring/" rel="tag">refactoring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-introducing-a-changeset-class-to-cruisecontrol-net-why" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-why/" class="article-date">
  <time datetime="2009-07-07T13:20:51.000Z" itemprop="datePublished">2009-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-why/">introducing a ChangeSet class to CruiseControl.net: why?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I want to make changes to CruiseControl.net’s object model to introduce the concept of <a target="_blank" rel="noopener" href="http://mercurial.selenic.com/wiki/ChangeSet">Changesets</a>. This is going to be a large change, so I’m expecting I’ll make a few more posts about it. My colleague <a target="_blank" rel="noopener" href="http://www.markhneedham.com/blog/">Mark Needham</a> already posted about a dojo where we did <a target="_blank" rel="noopener" href="http://www.markhneedham.com/blog/2009/06/12/coding-dojo-17-refactoring-cruise-control-net/">some experimentation</a> around this.</p>
<p>One of the important concepts in CruiseControl.net’s domain is changes to source code. Right now, those changes are modeled with a Modification class:</p>
<pre lang="csharp">///
/// Value object representing the data associated with a source control modification.
///
[XmlRoot("modification")]
public class Modification : IComparable
{
    public string Type = "unknown";
    public string FileName;
    public string FolderName;
    public DateTime ModifiedTime;
    public string UserName;
    public string ChangeNumber;
    public string Version = string.Empty;
    public string Comment;
    public string Url;
    public string IssueUrl;
    public string EmailAddress;
</pre>

<p>Modification was part of the <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/ccnet/changeset/e1e92ee1a612/">first commit</a> to sourceforge. Even back then, CruiseControl.net supported <a target="_blank" rel="noopener" href="http://bitbucket.org/davcamer/ccnet/src/457be6a966b7/project/core/sourcecontrol/">several source control</a> types: file-based, Perforce, PVCS, StarTeam and Visual Source Safe. A Modification object represents changes to one file. StarTeam, Perforce and PVCS have the concept of atomic changesets, but this is not supported by the model.</p>
<p>Changesets, though, <a target="_blank" rel="noopener" href="http://www.catb.org/esr/writings/version-control/version-control.html#files_vs_filesets">are important</a>. All new SCM systems deal primarily with changesets, rather than single file modifications. This has been the dominant model since at least the year 2000 when Subversion was released. Because they are important, I would like to change ccnet to support them as first-class members of the model. Otherwise, there ends up being code like the following, which is primarily concerned with reconstructing changesets for display purposes:</p>
<pre lang="csharp">private string WriteModificationsSummary(IEnumerable modifications)
{
    const string modificationHeaderFormat = "<tr><td>{0}</td><td>{1}</td></tr>";
    const string issueLinkFormat = "<tr><td>IssueLink</td><td><a>{0}</a></td></tr>";
    StringWriter mods = new StringWriter();

    mods.WriteLine("

#### Modifications in build :
");
    mods.WriteLine("<table>");
    ArrayList alreadyAdded = new ArrayList();
    foreach (Modification modification in modifications)
    {
        string modificationChecksum = modification.UserName + "__CCNET__" + modification.Comment;

        if (!alreadyAdded.Contains(modificationChecksum))
        {
            alreadyAdded.Add(modificationChecksum);

            mods.WriteLine(string.Format(modificationHeaderFormat,
                                         modification.UserName,
                                         modification.Comment));

            if (!string.IsNullOrEmpty(modification.IssueUrl))
            {
                mods.WriteLine(string.Format(issueLinkFormat,
                                             modification.IssueUrl));
            }
        }
    }
    mods.WriteLine("</table>");

    return mods.ToString();
}
</pre>

<p>I know that I want to introduce a Changeset class. This Changeset will represent the changesets from SCMs that have the concept. For SCMs that don’t it can represent groups of changes with the same comment and committer name, much like in the code above. In the long term, it should replace the Modification class.</p>
<p>At this point in any refactoring, I try to assess how much impact the refactoring will have. The way I go about the refactoring will be different if a lot of files will be touched, compared to one where only a few files will be touched. This is where ReSharper’s Find Usage functionality really shines:</p>
<p><img src="http://intwoplacesatonce.com/wp-content/uploads/2009/07/screen-capture.png" alt="screen-capture.png"></p>
<p>859 usages! So this is going to be a big refactoring. Even considering test code separately from application code: 291 in the application code, the remaining 563 in test code. There are 5 unlisted usages. I’m not sure why.</p>
<p>The “shape” of the listing is important as well as the size. The vast majority of the usages are in the Sourcecontrol namespace. I was expecting a lot of changes in the Sourcecontrol area because those classes will be returning a different type of object. That is the point of the refactoring. I was hoping for minimal impact on the rest of the ccnet code where Modification objects are consumed. Even in the long term, we can use an adapter sort of approach to work with Sourcecontrol blocks that can’t be updated to directly produce Changesets. But in the rest of the application, it would be nice to completely remove Modification in a short to medium time frame. Only relatively few places in Publishers, Tasks and Core will need to be changed to accomplish that. So, even though there are many references to the Modification class they are in a good place for this change to work.</p>
<p>The only other thing of note on the listing is that a capitilization difference, “Sourcecontrol” versus “SourceControl”, is causing the test’s namespace to be split. At least that’s a quick fix.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://intwoplacesatonce.com/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-why/" data-id="ckja6a8gl0005l99shtgc9wes" class="article-share-link">Share</a>
      
        <a href="http://intwoplacesatonce.com/2009/07/introducing-a-changeset-class-to-cruisecontrol-net-why/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cruisecontrol-net/" rel="tag">CruiseControl.net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/introducing-changeset/" rel="tag">introducing ChangeSet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/refactoring/" rel="tag">refactoring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-compiler-created-modules-in-f" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/05/compiler-created-modules-in-f/" class="article-date">
  <time datetime="2009-05-18T12:53:01.000Z" itemprop="datePublished">2009-05-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/05/compiler-created-modules-in-f/">compiler created modules in F#</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Lately I’ve been learning F#. I have used SML before for little experiments. SML is one of F#’s parents, and a lot of the basic syntax is familiar. The things I’ve been learning and discovering the most about are the large-scale issues. How does C# call F#? F# call C#? Or even, F# call F#? I wasn’t expecting that last one to be a challenge, but it was. Here’s why…</p>
<p>I started in the way I start almost any project: code in one place, tests in another. My first goal is to get the tests calling the code. This means a trivial test like making sure that a function returns true, when it… returns true.</p>
<p><img src="http://twoplaces.files.wordpress.com/2009/05/screen-capture-4.png" alt="screen-capture-4.png"></p>
<p>This is about the simplest F# solution I can picture. I’m already stumbling though, as evidenced by the red squiggly underneath always_true in TestsFile.fs. That squiggle is for a “The value or constructor ‘always_true’ is not defined.” error. But it is defined, over in CodeFile.fs, and I have no idea how to be more specific because all my declarations are top-level. I haven’t had to add any namespace or type names, which is nice. But as a result, I don’t know which namespaces or types these items are part of.</p>
<p>Opening the assemblies in reflector might help:</p>
<p><img src="http://twoplaces.files.wordpress.com/2009/05/screen-capture-1.png" alt="screen-capture-1.png"></p>
<p>There it is! My top-level declarations in CodeFile.fs are part of the CodeFile type in no namespace. always_true is there as a public static method, and my_true is there as a get-only public static property. There are three other internal types in there that have been created by the compiler.</p>
<p>F# will provide this automatic module even if an explicit module is declared in the file. For example, you might think that since always_true and my_true ended up as part of the CodeFile type, that the code in the screenshot above is equivalent to</p>
<pre lang="ocaml">module CodeFile =
    let my_true = true
    let always_true () = my_true</pre>
<p>Just to check, I’ll compile that and open it up in Reflector again.</p>
<p><img src="http://twoplaces.files.wordpress.com/2009/05/screen-capture-2.png" alt="screen-capture-2.png"></p>
<p>Instead of overwriting the automatic module, the explicitly declared module is nested inside of the automatic module. The public static type CodeFile, has a nested public static type CodeFile+CodeFile. Not what I was expecting.</p>
<p>The automatic module will continue to be produced unless I add a namespace declaration.</p>
<pre lang="ocaml">namespace Code

module CodeFile =
    let my_true = true
    let always_true () = my_true</pre>
<p>This ends up with a structure more familiar from C# work. CodeFile is a type within the Code namespace.</p>
<p><img src="http://twoplaces.files.wordpress.com/2009/05/screen-capture-3.png" alt="screen-capture-3.png"></p>
<p>I now have a pretty good picture of how the automatic naming works, but there are still scenarios I’d like to try. First, what happens if I declare a namespace but don’t include an explicit module declaration? I have a hunch, but I’ll try it to confirm.</p>
<p>This surprised me! This is a compile-time error. There is no automatic module creation to make this work.</p>
<pre lang="ocaml">namespace Code

let my_true = true // compile-time error: "Namespaces may not contain values.
                   // Consider using a module to hold your value declarations."

module CodeFile =
    let always_true () = my_true // ok</pre>
<p>The second question I had in mind was about mixing a module declaration and top-level declarations in one file. This has been resolved by the previous findings, though. If my file has a namespace declaration, the top-level declarations will be illegal. If it does not have a namespace declaration, then an automatic module with the name of the file will be created.</p>
<p>This is a simpler result than I was expecting, because it means there is only a single rule at play:</p>
<ol>
<li> If an .fs file does not include a namespace declaration, a module will be created in the top-most namespace to contain the file’s declarations.<br>Knowing this, I can return my code under test to how it looked before and get my tests working.</li>
</ol>
<p>In CodeFile.fs, in the Code project:</p>
<pre lang="ocaml">#light

let always_true () = true</pre>
<p>In TestsFile.fs, in the Tests project:</p>
<pre lang="ocaml">#light

open Xunit

[<Fact>] let true_is_true () = Assert.True(CodeFile.always_true ())</pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://intwoplacesatonce.com/2009/05/compiler-created-modules-in-f/" data-id="ckja6a8gb0000l99s68ib8ay6" class="article-share-link">Share</a>
      
        <a href="http://intwoplacesatonce.com/2009/05/compiler-created-modules-in-f/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/f/" rel="tag">f#</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&amp;laquo; __(&#39;prev&#39;)</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/cruisecontrol-net/" rel="tag">CruiseControl.net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mercurial/" rel="tag">Mercurial</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/subversion/" rel="tag">Subversion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/" rel="tag">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/batch-files/" rel="tag">batch files</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blocks/" rel="tag">blocks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broken-code/" rel="tag">broken code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/brutal-cast/" rel="tag">brutal cast</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/casting/" rel="tag">casting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmd-scripts/" rel="tag">cmd scripts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-on-bitbucket/" rel="tag">code on bitbucket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compiler/" rel="tag">compiler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/composition-over-inheritance/" rel="tag">composition over inheritance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-export/" rel="tag">data export</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debugging/" rel="tag">debugging</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dispatch/" rel="tag">dispatch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dispose/" rel="tag">dispose</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/duplication/" rel="tag">duplication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dynamic/" rel="tag">dynamic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/extension-methods/" rel="tag">extension methods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/f/" rel="tag">f#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fat32/" rel="tag">fat32</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gmaps/" rel="tag">gmaps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-maps/" rel="tag">google maps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hg/" rel="tag">hg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hgsubversion/" rel="tag">hgsubversion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/howto/" rel="tag">howto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interactionist/" rel="tag">interactionist</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/introducing-changeset/" rel="tag">introducing ChangeSet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/layout/" rel="tag">layout</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lean-on-the-compiler/" rel="tag">lean on the compiler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/message/" rel="tag">message</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/meta/" rel="tag">meta</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mixin/" rel="tag">mixin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/" rel="tag">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/msbuild/" rel="tag">msbuild</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/object-instantiation/" rel="tag">object instantiation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/objective-c/" rel="tag">objective-c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/open-source/" rel="tag">open source</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/partial-classes/" rel="tag">partial classes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/performance/" rel="tag">performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgres/" rel="tag">postgres</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/psql/" rel="tag">psql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/putty/" rel="tag">putty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rdc/" rel="tag">rdc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/recovery/" rel="tag">recovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redshift/" rel="tag">redshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refactoring/" rel="tag">refactoring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/remote-desktop-connection/" rel="tag">remote desktop connection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resource-acquisition/" rel="tag">resource acquisition</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scope/" rel="tag">scope</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/screen/" rel="tag">screen</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh-tunnel/" rel="tag">ssh tunnel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svcutil/" rel="tag">svcutil</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/" rel="tag">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcpip/" rel="tag">tcpip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test-doubles/" rel="tag">test doubles</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/testing/" rel="tag">testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unit-tests/" rel="tag">unit tests</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unix/" rel="tag">unix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/using/" rel="tag">using</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewport/" rel="tag">viewport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win7/" rel="tag">win7</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/winxp/" rel="tag">winxp</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/cruisecontrol-net/" style="font-size: 16.67px;">CruiseControl.net</a> <a href="/tags/mercurial/" style="font-size: 10px;">Mercurial</a> <a href="/tags/subversion/" style="font-size: 10px;">Subversion</a> <a href="/tags/automation/" style="font-size: 10px;">automation</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/batch-files/" style="font-size: 10px;">batch files</a> <a href="/tags/blocks/" style="font-size: 10px;">blocks</a> <a href="/tags/broken-code/" style="font-size: 10px;">broken code</a> <a href="/tags/brutal-cast/" style="font-size: 10px;">brutal cast</a> <a href="/tags/c/" style="font-size: 20px;">c#</a> <a href="/tags/casting/" style="font-size: 10px;">casting</a> <a href="/tags/cmd-scripts/" style="font-size: 10px;">cmd scripts</a> <a href="/tags/code-on-bitbucket/" style="font-size: 10px;">code on bitbucket</a> <a href="/tags/compiler/" style="font-size: 10px;">compiler</a> <a href="/tags/composition-over-inheritance/" style="font-size: 10px;">composition over inheritance</a> <a href="/tags/data-export/" style="font-size: 10px;">data export</a> <a href="/tags/debugging/" style="font-size: 10px;">debugging</a> <a href="/tags/dispatch/" style="font-size: 10px;">dispatch</a> <a href="/tags/dispose/" style="font-size: 10px;">dispose</a> <a href="/tags/duplication/" style="font-size: 13.33px;">duplication</a> <a href="/tags/dynamic/" style="font-size: 13.33px;">dynamic</a> <a href="/tags/extension-methods/" style="font-size: 10px;">extension methods</a> <a href="/tags/f/" style="font-size: 10px;">f#</a> <a href="/tags/fat32/" style="font-size: 10px;">fat32</a> <a href="/tags/gmaps/" style="font-size: 10px;">gmaps</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/google-maps/" style="font-size: 10px;">google maps</a> <a href="/tags/hg/" style="font-size: 10px;">hg</a> <a href="/tags/hgsubversion/" style="font-size: 10px;">hgsubversion</a> <a href="/tags/howto/" style="font-size: 10px;">howto</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/interactionist/" style="font-size: 10px;">interactionist</a> <a href="/tags/introducing-changeset/" style="font-size: 13.33px;">introducing ChangeSet</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/layout/" style="font-size: 10px;">layout</a> <a href="/tags/lean-on-the-compiler/" style="font-size: 10px;">lean on the compiler</a> <a href="/tags/message/" style="font-size: 10px;">message</a> <a href="/tags/meta/" style="font-size: 10px;">meta</a> <a href="/tags/mixin/" style="font-size: 10px;">mixin</a> <a href="/tags/mobile/" style="font-size: 10px;">mobile</a> <a href="/tags/msbuild/" style="font-size: 10px;">msbuild</a> <a href="/tags/object-instantiation/" style="font-size: 10px;">object instantiation</a> <a href="/tags/objective-c/" style="font-size: 10px;">objective-c</a> <a href="/tags/open-source/" style="font-size: 10px;">open source</a> <a href="/tags/partial-classes/" style="font-size: 10px;">partial classes</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/postgres/" style="font-size: 10px;">postgres</a> <a href="/tags/psql/" style="font-size: 10px;">psql</a> <a href="/tags/putty/" style="font-size: 10px;">putty</a> <a href="/tags/rdc/" style="font-size: 10px;">rdc</a> <a href="/tags/recovery/" style="font-size: 10px;">recovery</a> <a href="/tags/redshift/" style="font-size: 13.33px;">redshift</a> <a href="/tags/refactoring/" style="font-size: 20px;">refactoring</a> <a href="/tags/remote-desktop-connection/" style="font-size: 10px;">remote desktop connection</a> <a href="/tags/resource-acquisition/" style="font-size: 10px;">resource acquisition</a> <a href="/tags/scope/" style="font-size: 10px;">scope</a> <a href="/tags/screen/" style="font-size: 10px;">screen</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/ssh-tunnel/" style="font-size: 10px;">ssh tunnel</a> <a href="/tags/svcutil/" style="font-size: 10px;">svcutil</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/tcpip/" style="font-size: 10px;">tcpip</a> <a href="/tags/test-doubles/" style="font-size: 10px;">test doubles</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/unit-tests/" style="font-size: 10px;">unit tests</a> <a href="/tags/unix/" style="font-size: 10px;">unix</a> <a href="/tags/using/" style="font-size: 10px;">using</a> <a href="/tags/viewport/" style="font-size: 10px;">viewport</a> <a href="/tags/win7/" style="font-size: 10px;">win7</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/winxp/" style="font-size: 10px;">winxp</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">January 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/11/">November 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">August 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/07/">July 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/01/exporting-data-from-redshift/">exporting data from redshift</a>
          </li>
        
          <li>
            <a href="/2017/01/specifying-distkey-on-a-redshift-temp-table-in-datagrip/">specifying distkey on a redshift temp table in DataGrip</a>
          </li>
        
          <li>
            <a href="/2011/09/the-other-thing-about-using-blocks/">the other thing about &#34;using&#34; blocks</a>
          </li>
        
          <li>
            <a href="/2011/06/the-viewport-meta-tag-and-iphone/">the viewport meta tag, and iPhone</a>
          </li>
        
          <li>
            <a href="/2010/10/restoring-recovered-files-identity/">restoring recovered files identity</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 David Cameron<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'in-two-places-at-once';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>